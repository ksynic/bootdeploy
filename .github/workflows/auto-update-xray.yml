      - name: Commit & push
        if: steps.rel.outputs.need == 'true'
        run: |
          set -euo pipefail
          git config user.name github-actions[bot]
          git config user.email github-actions[bot]@users.noreply.github.com

          git add Xraycore
          git commit -m "chore(xray): update to ${{ steps.rel.outputs.tag }}" || exit 0

          # ✅ 防并发：最多重试 8 次
          for i in 1 2 3 4 5 6 7 8; do
            echo "Push attempt $i..."
            git fetch origin main
            git rebase origin/main || (git rebase --abort && exit 1)

            if git push origin HEAD:main; then
              echo "✅ Push succeeded"
              exit 0
            fi

            echo "⚠️ Push failed due to race; retrying..."
            sleep $((i*2))
          done

          echo "❌ Push failed after retries"
          exit 1
